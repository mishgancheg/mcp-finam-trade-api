# Demo-Agent Testing with train.csv

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ demo-agent –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `train.csv` –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –º–µ—Ç—Ä–∏–∫–∏ accuracy.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç

1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–∑ `train.csv`
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –≤ demo-agent —á–µ—Ä–µ–∑ API
3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—ã–∑–≤–∞–Ω–Ω—ã–µ API endpoints –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ (—á–µ—Ä–µ–∑ `SHOW_MCP_ENDPOINTS`)
4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ endpoints —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏ –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞
5. –í—ã—á–∏—Å–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫—É accuracy
6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `wrong_requests.json` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—à–∏–±–∫–∞—Ö

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- MCP server –∑–∞–ø—É—â–µ–Ω —Å `SHOW_MCP_ENDPOINTS=true`
- Demo-agent –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ MCP —Å–µ—Ä–≤–µ—Ä—É
- Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–π—Ç–µ `.env` (–∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ `.env.example`):

```bash
# MCP Server
API_BASE_URL=https://api.finam.ru/v1
API_SECRET_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
ACCOUNT_ID=–≤–∞—à_–∞–∫–∫–∞—É–Ω—Ç
RETURN_AS=json
SHOW_MCP_ENDPOINTS=true  # –í–ê–ñ–ù–û: –≤–∫–ª—é—á–∏—Ç—å endpoints
MCP_HTTP_PORT=3001

# Demo-agent (demo-agent/.env)
ANTHROPIC_API_KEY=–≤–∞—à_–∫–ª—é—á_anthropic
MCP_SERVER_URL=http://localhost:3001/mcp/v1
WEB_API_PORT=3002
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å MCP server

–í **—Ç–µ—Ä–º–∏–Ω–∞–ª–µ 1**:

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
npm run build
npm run mcp:http
```

–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üöÄ MCP Server running on port 3001
Response format: json
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å demo-agent

–í **—Ç–µ—Ä–º–∏–Ω–∞–ª–µ 2**:

```bash
cd demo-agent
npm install  # –µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
npm run build  # –µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–±—Ä–∞–Ω–æ
npm run dev
```

–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
Agent manager initialized successfully
Demo Agent API server running on http://localhost:3002
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç

–í **—Ç–µ—Ä–º–∏–Ω–∞–ª–µ 3**:

```bash
node demo-agent/test/test-train-csv.js
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å

```
üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è demo-agent –Ω–∞ train.csv...

‚úÖ Demo-agent –¥–æ—Å—Ç—É–ø–µ–Ω

üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ train.csv...
   –ó–∞–≥—Ä—É–∂–µ–Ω–æ 100 –∑–∞–ø–∏—Å–µ–π

üîß –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏...
   Session ID: abc123...

üöÄ –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

[1/100] UID: 8566443a
Question: –ü—Ä–æ—à—É –æ—Ç–º–µ–Ω–∏—Ç—å –æ—Ä–¥–µ—Ä ORD789789
Expected: DELETE DELETE /v1/accounts/{account_id}/orders/ORD789789
‚úÖ PASS

[2/100] UID: f937da73
Question: –û—Ç–∑–æ–≤–∏ –º–æ—é –∑–∞—è–≤–∫—É ORD911911
Expected: DELETE DELETE /v1/accounts/{account_id}/orders/ORD911911
‚úÖ PASS

...

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:       100
–ü—Ä–æ–π–¥–µ–Ω–æ:             87
–ü—Ä–æ–≤–∞–ª–µ–Ω–æ:            13
Accuracy:             87.00%
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üíæ –û—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: demo-agent/test/wrong_requests.json
   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫: 13
```

### –§–∞–π–ª wrong_requests.json

–°–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–∞–∂–¥–æ–º—É –Ω–µ–ø—Ä–æ—à–µ–¥—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É:

```json
[
  {
    "uid": "abc123",
    "type": "GET",
    "question": "–ü–æ–∫–∞–∂–∏ –º–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å",
    "expected_request": "GET /v1/accounts/{account_id}",
    "actual_endpoints": [
      "/v1/sessions",
      "/v1/accounts/12345"
    ],
    "reason": "Expected: /v1/accounts/{account_id}, Got: /v1/sessions, /v1/accounts/12345",
    "agent_response": "–í–∞—à –ø–æ—Ä—Ç—Ñ–µ–ª—å..."
  }
]
```

## –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Endpoints –Ω–µ –Ω–∞–π–¥–µ–Ω—ã**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `SHOW_MCP_ENDPOINTS=true` –≤ .env
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ MCP server –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç endpoints**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –≤ —Å–∫—Ä–∏–ø—Ç–µ
   - –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `normalizeEndpoint()`

3. **Agent –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –≤–æ–ø—Ä–æ—Å**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ system prompt –≤ AgentManager
   - –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω—ã –ø—Ä–∏–º–µ—Ä—ã (few-shot)

4. **–¢–∞–π–º–∞—É—Ç—ã**
   - –£–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ Anthropic API

## –î–æ—Ä–∞–±–æ—Ç–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞

### –ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

–í `test-train-csv.js`:

```javascript
// –ó–∞–¥–µ—Ä–∂–∫–∞ 100–º—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
await new Promise((resolve) => setTimeout(resolve, 100));

// –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 500–º—Å
await new Promise((resolve) => setTimeout(resolve, 500));
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö

```javascript
// –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 –∑–∞–ø–∏—Å–µ–π
const trainData = loadTrainCsv().slice(0, 10);
```

### –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ sendMessage –¥–æ–±–∞–≤–∏—Ç—å:
console.log('Request payload:', JSON.stringify(payload, null, 2));
console.log('Response:', JSON.stringify(response, null, 2));
```

## –ú–µ—Ç—Ä–∏–∫–∞ Accuracy

```
Accuracy = (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π / –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤) * 100%
```

–ó–∞–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º**, –µ—Å–ª–∏:
- HTTP –º–µ—Ç–æ–¥ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (GET, POST, DELETE –∏ —Ç.–¥.)
- API –ø—É—Ç—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å —É—á–µ—Ç–æ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤)

## Troubleshooting

### MCP server –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ MCP server –∑–∞–ø—É—â–µ–Ω
curl http://localhost:3001/health

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
{"status":"ok","transports":["stdio","sse","streamable-http"],"returnAs":"json"}
```

### Demo-agent –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ demo-agent –∑–∞–ø—É—â–µ–Ω
curl http://localhost:3002/api/health

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
{"status":"ok","timestamp":"...","agentReady":true}
```

### Endpoints –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ `.env` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
```
SHOW_MCP_ENDPOINTS=true
```

–ó–∞—Ç–µ–º **–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å MCP server**.

### Permission denied –æ—à–∏–±–∫–∏

Windows –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PowerShell –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:

1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ `wrong_requests.json`
2. –î–æ—Ä–∞–±–æ—Ç–∞–π—Ç–µ prompts –≤ AgentManager
3. –î–æ–±–∞–≤—å—Ç–µ few-shot –ø—Ä–∏–º–µ—Ä—ã
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Ö–∞–∫–∞—Ç–æ–Ω–∞

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã: GitHub Issues

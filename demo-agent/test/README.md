# Demo-Agent Tests

–ù–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã demo-agent —Å FINAM Trade API —á–µ—Ä–µ–∑ MCP —Å–µ—Ä–≤–µ—Ä.

## –¢–µ—Å—Ç—ã

### 1. test_demo_agent.js - –¢–µ—Å—Ç –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–∞—Å—Å–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ demo-agent –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–∑–≤–∞–Ω–Ω—ã—Ö API endpoints.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–∑ `demo-agent/test/data/test.csv`
2. –°–æ–∑–¥–∞–µ—Ç –æ–¥–Ω—É —Å–µ—Å—Å–∏—é
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –≤ demo-agent —á–µ—Ä–µ–∑ REST API (`/api/chat`)
4. Demo-agent –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Claude –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ –∏ –≤—ã–∑–æ–≤–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö MCP tools
5. MCP Server –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç + —Å–ø–∏—Å–æ–∫ –≤—ã–∑–≤–∞–Ω–Ω—ã—Ö API endpoints
6. –¢–µ—Å—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç `endpoints` –∏–∑ MCP –æ—Ç–≤–µ—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–∞–º—è—Ç–∏
7. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç:
   - `_test-data/<timestamp>_result.json` - –ø–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ –≤—Å–µ–º–∏ endpoints
   - `_test-data/<timestamp>_submission.csv` - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π endpoint –∏–∑ –∫–∞–∂–¥–æ–≥–æ –º–∞—Å—Å–∏–≤–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ë–∞—Ç—á–∏ –ø–æ 50 –∑–∞–ø—Ä–æ—Å–æ–≤
- –ó–∞–¥–µ—Ä–∂–∫–∞ 500ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –§–æ—Ä–º–∞—Ç CSV: `uid;type;request`

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
# Terminal 1: Start MCP server with endpoints enabled
SHOW_MCP_ENDPOINTS=true npm run mcp:http

# Terminal 2: Start demo-agent
cd demo-agent && npm start

# Terminal 3: Run test
node demo-agent/test/test_demo_agent.js
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```csv
uid;type;request
2ec2f3dc;GET;/v1/sessions
1ebb3c68;GET;/v1/assets
```

---

### 2. test-concurrent.js - –¢–µ—Å—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ `accountId`.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç 3 —Ä–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –¥–ª—è 3 —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (Promise.all) 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ "–ü–æ–∫–∞–∂–∏ –º–æ–π –∞–∫–∫–∞—É–Ω—Ç"
3. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π `accountId` (111111, 222222, 333333)
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è –ø–æ–ª—É—á–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤–æ–µ–≥–æ `accountId`
5. –í—ã–≤–æ–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –≤–æ–∑–º–æ–∂–Ω–æ–π race condition

**–¶–µ–ª—å —Ç–µ—Å—Ç–∞:**
–í—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å concurrent request handling, –∫–æ–≥–¥–∞ credentials –º–æ–≥—É—Ç –ø–µ—Ä–µ–º–µ—à–∞—Ç—å—Å—è –º–µ–∂–¥—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏.

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
# Terminal 1: Start demo-agent
cd demo-agent && npm start

# Terminal 2: Run test
node demo-agent/test/test-concurrent.js
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ –ö–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤–æ–π `accountId`
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –º–µ—à–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É
- ‚ö†Ô∏è –ù–µ—Ç race condition –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ MCP —Å–µ—Ä–≤–µ—Ä—É

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | test_demo_agent.js | test-concurrent.js |
|----------|-------------------|-------------------|
| **–¶–µ–ª—å** | –ú–∞—Å—Å–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **–î–∞–Ω–Ω—ã–µ** | –ò–∑ CSV —Ñ–∞–π–ª–∞ (—Ä–µ–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã) | –•–∞—Ä–¥–∫–æ–¥ ("–ü–æ–∫–∞–∂–∏ –º–æ–π –∞–∫–∫–∞—É–Ω—Ç") |
| **–°–µ—Å—Å–∏–∏** | –û–¥–Ω–∞ —Å–µ—Å—Å–∏—è | 3 —Å–µ—Å—Å–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| **–ó–∞–ø—Ä–æ—Å—ã** | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞—Ç—á–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ (Promise.all) |
| **accountId** | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (111111, 222222, 333333) |
| **–†–µ–∑—É–ª—å—Ç–∞—Ç** | JSON + CSV —Å endpoints | –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ |
| **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç** | –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ endpoints –∏–∑ MCP | Race conditions –∏ –∏–∑–æ–ª—è—Ü–∏—é —Å–µ—Å—Å–∏–π |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### test.csv
```csv
uid;question
2ec2f3dc;–ì–ª—É–±–∏–Ω–∞ —Ä—ã–Ω–∫–∞ –¥–ª—è RIZ5@RTSX.
1ebb3c68;–ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –†–æ—Å–Ω–µ—Ñ—Ç–∏.
d9c5a7c5;–ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –æ—Ä–¥–µ—Ä–æ–º ORDERR01?
```

### –§–æ—Ä–º–∞—Ç MCP –æ—Ç–≤–µ—Ç–∞ (–∏–∑ demo-agent)
```json
{
  "sessionId": "...",
  "message": "...",
  "toolCalls": [
    {
      "result": {
        "content": [
          {
            "endpoints": ["GET;/v1/sessions", "POST;/v1/accounts/123/orders"],
            "type": "text",
            "text": "üìù"
          }
        ]
      }
    }
  ]
}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç test_demo_agent.js

**JSON (_test-data/<timestamp>_result.json):**
```json
[
  {
    "uid": "2ec2f3dc",
    "type": "GET",
    "endpoints": ["GET;/v1/sessions", "POST;/v1/accounts/123/orders"]
  }
]
```

**CSV (_test-data/<timestamp>_submission.csv):**
```csv
uid;type;request
2ec2f3dc;GET;/v1/sessions
1ebb3c68;GET;/v1/assets
```

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Base URL –¥–ª—è demo-agent API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
DEMO_API_BASE=http://localhost:3002

# MCP Server –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ endpoints
SHOW_MCP_ENDPOINTS=true
```

---

## Troubleshooting

### test_demo_agent.js –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç endpoints
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ MCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω —Å `SHOW_MCP_ENDPOINTS=true`
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ demo-agent –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ MCP —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –≤ `toolCalls[].result.content[].endpoints`

### test-concurrent.js –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç race condition
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: credentials –ø–µ—Ä–µ–º–µ—à–∏–≤–∞—é—Ç—Å—è –º–µ–∂–¥—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–æ–ª—è—Ü–∏—é `accountId` –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- üîß –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ–∏ credentials –æ—Ç–¥–µ–ª—å–Ω–æ

### –û—à–∏–±–∫–∞ "Session not found"
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ demo-agent —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `sessionId`

---

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–µ—Å—Ç:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test-[–Ω–∞–∑–≤–∞–Ω–∏–µ].js` –≤ `demo-agent/test/`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
3. –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —ç—Ç–æ—Ç README.md
4. –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤—å—Ç–µ –≤ `demo-agent/test/data/`

**–ü—Ä–∏–º–µ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:**
```javascript
const API_BASE = 'http://localhost:3002';

async function createSession(userId) {
  const res = await fetch(`${API_BASE}/api/sessions`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userId })
  });
  return res.json();
}

async function sendMessage(sessionId, message) {
  const res = await fetch(`${API_BASE}/api/chat`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ sessionId, message })
  });
  return res.json();
}

async function runTest() {
  const session = await createSession('test-user');
  const response = await sendMessage(session.sessionId, '–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å');
  console.log(response);
}

runTest().catch(console.error);
```

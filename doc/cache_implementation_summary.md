# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. Disk Caching
‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `assets_data.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
‚úÖ –§–æ—Ä–º–∞—Ç: `{timestamp: number, assets: Asset[]}`
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API

### 2. STDIO Transport (–∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ - –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å)
‚úÖ –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–µ—à–∞ –Ω–∞ –¥–∏—Å–∫–µ
‚úÖ –ï—Å–ª–∏ –∫–µ—à —Å–≤–µ–∂–∏–π (<4 —á–∞—Å–∞) ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å –¥–∏—Å–∫–∞
‚úÖ –ï—Å–ª–∏ –∫–µ—à —Å—Ç–∞—Ä—ã–π (>4 —á–∞—Å–∞) ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ API ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ –¥–∏—Å–∫
‚úÖ –ï—Å–ª–∏ –∫–µ—à–∞ –Ω–µ—Ç ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç —á–µ—Ä–µ–∑ API ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ –¥–∏—Å–∫

### 3. HTTP/SSE Transport (–¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å)
‚úÖ –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–µ—à (—Å –¥–∏—Å–∫–∞ –∏–ª–∏ API)
‚úÖ –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞ —á–µ—Ä–µ–∑ setInterval
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: API ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫ ‚Üí –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –ø–∞–º—è—Ç–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã
- **src/services/instrument-search.ts**: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **assets_data.json**: –§–∞–π–ª –∫–µ—à–∞ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore)

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã
- `loadFromDisk()`: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–µ—à–∞ —Å –¥–∏—Å–∫–∞
- `saveToDisk(assets)`: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞ –Ω–∞ –¥–∏—Å–∫ —Å —Ç–µ–∫—É—â–∏–º timestamp
- `isCacheStale(timestamp)`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∫–µ—à–∞ (> 4 —á–∞—Å–æ–≤)
- `startCacheRefresh()`: –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è HTTP transport
- `stopCacheRefresh()`: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- `CACHE_FILE_PATH`: `<project-root>/assets_data.json`
- `CACHE_MAX_AGE`: 4 —á–∞—Å–∞ (14400000 –º—Å)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–µ—Ç –∫–µ—à–∞
```bash
# –£–¥–∞–ª–∏—Ç—å –∫–µ—à
rm assets_data.json

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
node test/search/test-cache-loading.js

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# üì• No disk cache found, fetching from API...
# ‚òëÔ∏è Fetched X instruments from API
# üíæ Saved X instruments to disk cache
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–≤–µ–∂–∏–π –∫–µ—à (< 4 —á–∞—Å–æ–≤)
```bash
# –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞
node test/search/test-cache-loading.js

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# üìÇ Loaded X instruments from disk cache
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–µ—à (> 4 —á–∞—Å–æ–≤)
```bash
# –¢–µ—Å—Ç —Å–æ —Å—Ç–∞—Ä—ã–º –∫–µ—à–µ–º
node test/search/test-isolated-stale.js

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# ‚è∞ Disk cache is stale (>4 hours), refreshing...
# ‚òëÔ∏è Fetched X instruments from API
# üíæ Saved X instruments to disk cache
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### STDIO Transport
- **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (~2-5 —Å–µ–∫)
- **–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏**: –ó–∞–≥—Ä—É–∑–∫–∞ —Å –¥–∏—Å–∫–∞ (~50-200 –º—Å)
- **–£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–µ—à**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### HTTP/SSE Transport
- **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞**: –ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –ø–∞–º—è—Ç—å
- **–ü–æ–∏—Å–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**: < 1 –º—Å (–∏–Ω–¥–µ–∫—Å—ã –≤ –ø–∞–º—è—Ç–∏)
- **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ö–∞–∂–¥—ã–µ 4 —á–∞—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ (HTTP/SSE)
‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫ (assets_data.json)
‚úÖ STDIO: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ
‚úÖ HTTP/SSE: –∑–∞–≥—Ä—É–∑–∫–∞ –æ–¥–∏–Ω —Ä–∞–∑ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞
‚úÖ –ú–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏ (> 4 —á–∞—Å–æ–≤)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### STDIO
```bash
npm run mcp  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º
```

### HTTP/SSE
```bash
npm run mcp:http  # –ö–µ—à –≤ –ø–∞–º—è—Ç–∏ + –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

### –¢–µ—Å—Ç—ã
```bash
npm run test:search:direct     # –ü—Ä—è–º–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
node test/search/test-cache-loading.js  # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–µ—à–∞
node test/search/test-isolated-stale.js # –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–µ—à
```
